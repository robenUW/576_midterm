<!DOCTYPE html>
<html lang="en">
<head>
  <title>Lab 3</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="" />

<!----Calls for arcgis JS file and CSS library per lab 1 instructions-->
<link rel="stylesheet" href="https://js.arcgis.com/4.27/esri/themes/light/main.css">
<script src="https://js.arcgis.com/4.27/"></script>

<!---css to make full screen map-->
<style>  
  html,  
  body,  
  #viewDiv {  
    padding: 0;  
    margin: 0;  
    height: 100%;  
    width: 100%;  
  }  


</style> 
<!--Calling for Map and Mapview modules-->

<script> 

require(["esri/config", "esri/Map", "esri/views/MapView", "esri/widgets/BasemapGallery", "esri/widgets/Locate", "esri/widgets/Search","esri/widgets/Expand", "esri/Graphic",  
"esri/layers/GraphicsLayer","esri/geometry/Point","esri/symbols/SimpleMarkerSymbol","esri/PopupTemplate","esri/geometry/Polyline","esri/geometry/Polygon","esri/layers/FeatureLayer",  "esri/core/reactiveUtils","esri/popup/content/TextContent", "esri/renderers/SimpleRenderer","esri/symbols/PictureMarkerSymbol","esri/widgets/Editor","esri/widgets/Legend","esri/widgets/LayerList"],
function (esriConfig, Map, MapView,BasemapGallery,Locate,Search,Expand,Graphic,GraphicsLayer,Point,SimpleMarkerSymbol,PopupTemplate,Polyline,Polygon,FeatureLayer,reactiveUtils, TextContent,SimpleRenderer,PictureMarkerSymbol,Editor,Legend,LayerList) {
 // brings in my API 
esriConfig.apiKey = "AAPKe25646307673446889b5a9c8e433dbd9RUONhu0G0j2uuWyYnq7Ocn8NTpfkWTTsgyAcMmgDmQzorADXUER36WiN9p7mq3FU" 

const map = new Map({ 
  basemap: "arcgis-light-gray" // Basemap layer 
});


const view = new MapView({
map: map,
center: [-86.814947,  30.374074], // Longitude, latitude
zoom: 9, // Zoom level
container: "viewDiv" // Div element
});


//adds basemap gallery
const basemapGallery = new BasemapGallery({
  view: view
});
    
const locateBtn = new Locate({
          view: view
        });

        // Add the locate widget to the top left corner of the view
        view.ui.add(locateBtn, {
          position: "top-left"
        });    

        
const searchWidget = new Search({
  view: view
});
// Adds the search widget below other elements in
// the top left corner of the view
view.ui.add(searchWidget, {
  position: "top-left",
  index: 2
});

//adds expand to the basemap widget
const bgExpand = new Expand({
          view: view,
          content: basemapGallery,
        });

        // close the expand whenever a basemap is selected
        basemapGallery.watch("activeBasemap", () => {
          const mobileSize = view.heightBreakpoint === "xsmall" || view.widthBreakpoint === "xsmall";

          if (mobileSize) {
            bgExpand.collapse();
          }
        });

        view.ui.add(bgExpand, "top-right");
        
//adds the constructor for the graphics layer; see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const
const graphicsLayer = new GraphicsLayer();  
  map.add(graphicsLayer);

//defines geometry of the point
const point = { //Create a point  
  type: "point",  
  longitude: -92.044,    //long lat of Stevie Ray Vaughan Statue
  latitude: 30.2250
};


//defines the marker style
const simpleMarkerSymbol = {  
  type: "simple-marker",
  style: "diamond",
  size:  "15px",
  color: [0, 255, 255],  
  outline: {  
    color: [102, 0, 0], 
    width: 2
  }  
};


//define popup for REST service
const bminputs = {
"title": "Beach Mouse Input Layers",
"content": "<b>Values:</b> {value} <br>"
}

const featureservice = new FeatureLayer({
  // URL to the service
  url: "https://services.arcgis.com/HRPe58bUyBqyyiCt/arcgis/rest/services/Beach_Mouse_Inputs/FeatureServer",
  //adding popup
  popupTemplate: bminputs,
  portalItem: {
    id: "5d59943d7e3d466bb85d8aa356e6cc73"
  },
  layerId: 4,
  content: [
    {
    outFields: ["*"],
    fieldInfos: [
    {fieldName: "Value"}
    ]}]
});


//define popup for REST service
const projectpopup = {
  "title": "Project Location Ideas",
  "content": "<b>Project Name:</b> {PName} <br> <b>Creator:</b> {Creator} <br> <b> Start Date: </b> {StartDate} <br> Project End Date: </b> {Enddate} <br>"
}

const projectservice = new FeatureLayer({
  // URL to the service
  url: "https://services.arcgis.com/HRPe58bUyBqyyiCt/arcgis/rest/services/Project_Location_Ideas/FeatureServer",
  popupTemplate: projectpopup,
})


//creates renderer for editable icons to use icon
const myvisitrenderer = {
    "type": "simple",
    "symbol": {
    "type": "picture-marker",
    "url": "https://robenuw.github.io/576lab3/R.png",
    "width": "25px",
    "height": "25px"
  }
}

//const to make the new editable layer labels
const visitLabels = {
  symbol: {
    type: "text",
    color: "#00008b",
    haloColor: "#add8e6",
    haloSize: "2px",
    font: {
      size: "12px",
      family: "Noto Sans",
      style: "italic",
      weight: "normal"
    }
  },
  labelPlacement: "above-center",
  labelExpressionInfo: {
    expression: "$feature.AirportCode"
  }
};


//adding the const for the feature layer
const myvisits = new FeatureLayer({
 url: "https://services.arcgis.com/HRPe58bUyBqyyiCt/arcgis/rest/services/Visits/FeatureServer",
 renderer: myvisitrenderer,
 //adding the popup here
 outFields: ["AirportCode"],
 labelingInfo: [visitLabels], //adding the labels
    content: [
      {
      outFields: ["*"],
    }
  ]
});


//adding the feature layer to the map
map.add(myvisits);

// Set the point layer's LayerInfo
const pointInfos = {
 layer: myvisits
}

// Begin Editor constructor
const editor = new Editor({
 view: view,
 layerInfos: [pointInfos]
 }); // End Editor constructor


// adds legend widget
const legend = new Legend({
  view: view,
  icon: "Legend",
  label: "Legend",
  layerInfos:
  [{layer:myvisits,
  title: "My Visits"},
  {layer: featureservice,
  title:  "Intact Habitat Cores (2023)"}]
  
});
 
//add expand for legend 

const lgExpand = new Expand({
          view: view,
          content: legend,
          expandIcon: "legend",
        });

        // close the expand whenever a basemap is selected
        legend.watch("activeLegend", () => {
          const mobileSize2 = view.heightBreakpoint === "xsmall" || view.widthBreakpoint === "xsmall";

          if (mobileSize2) {
            lgExpand.collapse();
          }
        });

        view.ui.add(lgExpand, "bottom-right");


//expands editor widget
const editExpand = new Expand({
  view: view,
  content: editor,
  expandIcon: "add-in-edit"
});

editor.watch("activeEditor", () => {
  const mobileSize3 = view.heightBreakpoint === "xsmall" || view.widthBreakpoint === "xsmall";

  if (mobileSize3) {
    editExpand.collapse();
  }
});

view.ui.add(editExpand, "top-right");



           // Add widget to the top right corner of the view
const layerList = new LayerList({
    view: view,
    icon: "map-contents"
  // executes for each ListItem in the LayerList
});


const listexpand = new Expand({
  view: view,
  content: layerList,
  icon: "map-contents"
});



view.ui.add(listexpand, "top-right")


//adding the feature layers to the map
map.add(featureservice);
map.add(projectservice);
});
</script>

</head>
<body>
  <!---Div to display the map-->
  <div id="viewDiv"></div> 
</body>
</html>
